# Отчёт: Как работает система учёта денег в программе GARANT

## Введение

Эта инструкция объясняет, как программа считает деньги, ведёт учёт и формирует отчёты. Всё описано простым языком без технических терминов.

---

## 1. Основные понятия

В программе есть несколько видов записей о деньгах:

| Название | Что это |
|----------|---------|
| **Приход** | Деньги, которые поступили (оплата от клиентов) |
| **Расход** | Деньги, которые потратили (закупки, зарплаты и т.д.) |
| **Баланс мастера** | Сколько денег компания должна мастеру за работу |
| **Касса** | Текущая сумма наличных в кассе |

---

## 2. Как работают приходы (деньги от клиентов)

### 2.1. Автоматические приходы при создании заказа

Когда вы сохраняете заказ, программа **автоматически** создаёт две записи о приходе:

1. **Предоплата** — сумма, которую клиент заплатил сразу
2. **Доплата** — остаток, который клиент заплатит при получении

**Пример:**
- Общая стоимость ремонта: 10 000 ₽
- Предоплата: 3 000 ₽
- Доплата (считается автоматически): 10 000 - 3 000 = 7 000 ₽

### 2.2. Кто создал запись

Когда вы меняете сумму предоплаты или доплаты и сохраняете заказ, программа записывает ваше имя как автора изменений. При этом автор обновляется сразу на обеих записях (и предоплата, и доплата), даже если вы изменили только одну сумму.

### 2.3. Подтверждение приходов

- Приходы могут быть **подтверждёнными** и **неподтверждёнными**
- Подтвердить приход может только **администратор**
- Когда администратор сохраняет заказ — приходы подтверждаются автоматически
- Подтверждённые приходы учитываются в отчётах

---

## 3. Как работают расходы (траты компании)

### 3.1. Категории расходов

Расходы делятся на категории (например: «Закупка запчастей», «Доставка», «Зарплата сотрудников»).

Особая категория — **«Зарплата сотрудников»**. Она влияет на баланс мастера.

### 3.2. Добавление расхода

При добавлении расхода указывается:
- Сумма
- Категория (из списка)
- Сотрудник (кому относится)
- Дата
- Комментарий

### 3.3. Подтверждение расхода

- Расходы может подтвердить только **администратор**
- Если категория = «Зарплата сотрудников», то при подтверждении баланс мастера **увеличивается** на эту сумму

### 3.4. Удаление расхода

Если удаляется подтверждённый расход с категорией «Зарплата сотрудников», то баланс мастера **уменьшается** на эту сумму.

---

## 4. Баланс мастера (сколько компания должна мастеру)

### 4.1. Что это

Баланс мастера показывает, сколько денег компания должна выплатить мастеру. Это накопленная сумма заработка.

### 4.2. Когда баланс увеличивается (+)

| Ситуация | Объяснение |
|----------|------------|
| Подтверждение расхода «Зарплата сотрудников» | Администратор подтвердил начисление зарплаты |
| Добавление зарплаты администратором | Администратор сразу добавил и подтвердил зарплату |
| Оплата за смену | Через специальную форму начисляется оплата за смену |
| Ручной приход мастеру | Через раздел учёта мастера добавлен приход |

### 4.3. Когда баланс уменьшается (-)

| Ситуация | Объяснение |
|----------|------------|
| Удаление подтверждённой зарплаты | Удалили запись о начисленной зарплате |
| Ручной расход мастеру | Через раздел учёта мастера добавлен расход (например, выдали наличные) |
| Удаление ручного прихода | Удалили ранее добавленный ручной приход |

### 4.4. Защита от ошибок при быстрых кликах

Если быстро нажать несколько кнопок подтверждения подряд, программа обрабатывает каждый клик по очереди, чтобы баланс посчитался правильно. Перед каждым изменением программа получает актуальный баланс, а потом обновляет его.

---

## 5. Касса (наличные деньги)

### 5.1. Типы операций с кассой

| Операция | Что происходит |
|----------|----------------|
| **Приход** | Деньги положили в кассу. Баланс кассы увеличивается |
| **Расход** | Деньги взяли из кассы. Баланс кассы уменьшается |
| **Корректировка** | Ручная установка точной суммы (например, после пересчёта) |

### 5.2. Кто может работать с кассой

- **Мастер** — может только вносить деньги в кассу (приход)
- **Администратор** — может делать все операции (приход, расход, корректировка)

---

## 6. Отчёты и статистика

### 6.1. Общие показатели

Программа считает следующие показатели:

| Показатель | Как считается |
|------------|---------------|
| Всего заказов | Количество всех заказов за период |
| Завершённых | Заказы со статусом «Выдан» и подтверждённые |
| Процент отказов | (Количество отказов ÷ Всего заказов) × 100% |
| Прибыль | Все приходы минус все расходы |

### 6.2. Фильтрация по датам

- Можно выбрать период (с какой по какую дату)
- Заказы фильтруются по дате создания
- Приходы и расходы фильтруются по дате, которую указал пользователь (если не указана — по дате создания записи)

### 6.3. Отчёт по сотруднику

Можно посмотреть статистику конкретного мастера:
- Сколько заказов в работе
- Сколько завершил
- Сколько отказов
- Общий доход

### 6.4. Отчёт по типу сервиса

Можно посмотреть статистику по видам ремонта:
- Выездной ремонт
- Стационарный ремонт
- UMedia

### 6.5. Диаграммы

Программа строит диаграммы по категориям:
- Приходы — сгруппированы по категориям доходов
- Расходы — сгруппированы по категориям расходов

---

## 7. Статусы заказов и их влияние на отчёты

| Статус | Что значит | Учитывается в отчётах |
|--------|------------|----------------------|
| Новая, Согласовать, Отремонтировать, Купить запчасти, Отправить курьера | Заказ в работе | Да, как «открытый» |
| **Выдан** (и подтверждён) | Ремонт завершён, техника выдана клиенту | Да, как «завершённый» |
| **Отказ** (и подтверждён) | Клиент отказался от ремонта | Да, как «отказ» |

**Важно:** Заказ учитывается в статистике только если он **подтверждён** администратором.

---

## 8. Роли пользователей и их права

### 8.1. Мастер

| Может | Не может |
|-------|----------|
| Добавлять приходы и расходы к заказам | Подтверждать приходы и расходы |
| Вносить деньги в кассу | Делать расход или корректировку кассы |
| Смотреть свои заказы | Удалять записи |
| | Редактировать чужие записи |

### 8.2. Менеджер

Расширенные права по сравнению с мастером. Доступ к дополнительным фильтрам.

### 8.3. Администратор

| Права |
|-------|
| Полный доступ ко всем функциям |
| Подтверждение приходов и расходов |
| Удаление любых записей |
| Любые операции с кассой (включая корректировку) |
| Его записи подтверждаются автоматически |

---

## 9. Формулы расчётов (простым языком)

### 9.1. Доплата за заказ
```
Доплата = Общая стоимость − Предоплата
```

**Пример:** Стоимость 15 000 ₽, предоплата 5 000 ₽ → Доплата = 10 000 ₽

### 9.2. Прибыль за период
```
Прибыль = Сумма всех приходов − Сумма всех расходов
```

**Пример:** Приходы 500 000 ₽, расходы 350 000 ₽ → Прибыль = 150 000 ₽

### 9.3. Процент отказов
```
Процент отказов = (Количество отказов ÷ Всего заказов) × 100%
```

**Пример:** 10 отказов из 200 заказов → 10 ÷ 200 × 100% = 5%

### 9.4. Изменение баланса мастера

**При начислении зарплаты:**
```
Новый баланс = Текущий баланс + Сумма зарплаты
```

**Пример:** Было 5 000 ₽, начислили 3 000 ₽ → Стало 8 000 ₽

**При удалении начисления:**
```
Новый баланс = Текущий баланс − Удалённая сумма
```

**Пример:** Было 8 000 ₽, удалили 3 000 ₽ → Стало 5 000 ₽

### 9.5. Изменение кассы

**Приход в кассу:**
```
Новый баланс кассы = Текущий баланс + Сумма прихода
```

**Расход из кассы:**
```
Новый баланс кассы = Текущий баланс − Сумма расхода
```

**Корректировка:**
```
Баланс кассы = Указанная сумма (полная замена)
```

---

## 10. Частые вопросы

### Почему приход не отображается в отчёте?
Возможные причины:
1. Приход не подтверждён (должен подтвердить администратор)
2. Дата прихода не входит в выбранный период отчёта

### Почему баланс мастера не изменился после добавления расхода?
Баланс мастера меняется только при расходах категории **«Зарплата сотрудников»**. Если выбрана другая категория — баланс не изменится.

### Почему при быстрых кликах раньше суммы считались неправильно?
Это было исправлено. Теперь программа обрабатывает каждый клик последовательно, всегда получая актуальный баланс перед изменением.

### Как исправить ошибку в кассе?
Используйте операцию **«Корректировка»** — она позволяет установить точную сумму кассы.

### Кто видит баланс мастера?
Мастер видит только свой баланс. Администратор видит балансы всех мастеров.

---

## 11. Краткий словарь терминов

| Термин | Значение |
|--------|----------|
| Приход | Поступление денег в компанию |
| Расход | Трата денег компанией |
| Баланс | Текущая сумма (денег на счету, в кассе или долга перед мастером) |
| Подтверждение | Одобрение записи администратором для учёта в отчётах |
| Корректировка | Ручная установка точной суммы (используется при пересчёте) |
| Предоплата | Часть оплаты, которую клиент вносит сразу |
| Доплата | Остаток оплаты, который клиент вносит при получении |

---

*Документ создан: Январь 2026*
